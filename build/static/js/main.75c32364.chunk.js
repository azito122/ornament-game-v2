(window["webpackJsonp2048-react"]=window["webpackJsonp2048-react"]||[]).push([[0],{175:function(e,t,n){e.exports=n(463)},180:function(e,t,n){},181:function(e,t,n){},182:function(e,t,n){},183:function(e,t,n){},184:function(e,t,n){},463:function(e,t,n){"use strict";n.r(t);var s=n(0),i=n.n(s),a=n(174),o=n.n(a),r=(n(180),n(10)),l=n(13),c=n(20),u=n(19),f=n(21),h=(n(181),function(){function e(t){Object(r.a)(this,e),this.values={},this.values=d(t)}return Object(l.a)(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.values[e];return"undefined"===typeof n||null===n?t:n}},{key:"getString",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=this.get(e);return String(t)}},{key:"set",value:function(e,t){return console.log("set",e,t),this.values[e]=t,this}}]),e}());function v(e,t){return Math.floor(Math.random()*(t-e)+e)}function p(e){return e[Math.floor(Math.random()*e.length)]}function d(e){return JSON.parse(JSON.stringify(e))}n(182);var g=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{onMouseOver:function(){e.props.handleHover(e.props.position)},onMouseLeave:function(){e.props.handleUnhover(e.props.position)},onClick:function(){e.props.handleClick(e.props.position,e.props.type)},className:"cell cell-type-".concat(this.props.type," cell-special-").concat(this.props.special," cell-status-").concat(this.props.status)},i.a.createElement("span",null))}}]),t}(i.a.Component),m=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"filling";Object(r.a)(this,e),this.type=void 0,this.special=void 0,this.status=void 0,this.type=t,this.special=n,this.status=s},y=(n(183),function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).buffer=void 0,n.hovered=void 0,n.targeted=void 0;var s=new m(0),i=Array(n.props.height).fill(Array(n.props.width).fill(s));return n.buffer=JSON.parse(JSON.stringify(i)),n.hovered=void 0,n.state={cells:i,locked:!1},n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"cells"},this.state.cells.map((function(t,n){return i.a.createElement("div",{key:n,className:"cells-row"},t.map((function(t,s){return i.a.createElement(g,{status:t.status,position:[s,n],key:4*n+s,type:t.type,handleClick:function(t){e.handleClick(t)},handleHover:function(t){e.handleHover(t)},handleUnhover:function(t){e.handleUnhover(t)},special:t.special})})))})))}},{key:"componentDidMount",value:function(){this.fillCells()}},{key:"handleUnhover",value:function(e){this.hovered=void 0,this.clearTargeted()}},{key:"clearTargeted",value:function(){this.targeted&&this.targeted.length>=3&&(this.untargetByPositions(this.targeted),this.state.locked||this.flushBuffer()),this.targeted=void 0}},{key:"handleHover",value:function(e){this.hovered=e;var t=this.findGroupPositions(e);t[0].length>=3&&(this.targeted=t[1],this.targetByPositions(t[1]),this.state.locked||this.flushBuffer())}},{key:"handleClick",value:function(e){var t=this;if(!this.state.locked&&this.targeted){var n=d(this.targeted);this.targeted=void 0,n.length>=3?(this.props.addScore(n.length),this.lock((function(){t.boomByPositions(n)}))):this.resetBuffer()}}},{key:"fillCells",value:function(e){var t,n=this;"undefined"!==typeof e&&(t=(t=Array(e>3?e-1:2).fill(null)).map((function(e,t){return n.getRandomTileType()})));this.buffer.forEach((function(e){e.forEach((function(s,i){0===s.type&&(e[i]=n.fillCell(t))}))})),this.flushBuffer(),this.unlock(),"undefined"!==typeof this.hovered&&(this.clearTargeted(),this.handleHover(this.hovered))}},{key:"fillCell",value:function(e){var t=this.getRandomTileType();if("undefined"!==typeof e)p(e);var n="";return v(1,100)<5&&(n=p(["borg","gold"])),new m(t,n)}},{key:"targetByPositions",value:function(e){var t=this;e.forEach((function(e){t.getCell(e).status="targeted"}))}},{key:"untargetByPositions",value:function(e){var t=this;e.forEach((function(e){t.getCell(e).status=""}))}},{key:"findGroupPositions",value:function(e){var t=this.getCell(e).type,n=d(this.buffer);return this.findMatchingAdjacent(n,e,t,[],[])}},{key:"findTypePositions",value:function(e){var t=[];return this.buffer.forEach((function(n,s){n.forEach((function(n,i){n.type===e&&t.push([i,s])}))})),t}},{key:"findMatchingAdjacent",value:function(e,t,n,s,i){var a=this;return 0===e[t[1]][t[0]].type?[s,i]:(s.push(t),i.push(t),"borg"===e[t[1]][t[0]].special&&(i=i.concat(this.findTypePositions(e[t[1]][t[0]].type))),e[t[1]][t[0]].type=0,this.getAdjacentPositions(t).forEach((function(t){if(a.getCell(t).type===n){var o=a.findMatchingAdjacent(e,t,n,s,i);i=o[1]}})),[s,i])}},{key:"getAdjacentPositions",value:function(e){var t=e[0],n=e[1];return[[t+1,n],[t-1,n],[t,n+1],[t,n-1]].filter((function(e){return function(e){return!(e[0]<0||e[1]<0||e[0]>=11||e[1]>=7)}(e)}))}},{key:"boomByPositions",value:function(e){var t=this;e.forEach((function(e){var n=t.getCell(e);"gold"===n.special&&t.props.addScore(15),n.status="booming"})),this.flushBuffer(),setTimeout((function(){e.forEach((function(e){var n=t.getCell(e);n.type,n.special;n.type=0,n.special="",n.status="booming"})),t.flushBuffer(),t.fillCells.bind(t)(e.length)}),500)}},{key:"boomByType",value:function(e){this.boomByPositions(this.findTypePositions(e)),this.flushBuffer()}},{key:"getCell",value:function(e){return this.buffer[e[1]][e[0]]}},{key:"flushBuffer",value:function(){var e=JSON.parse(JSON.stringify(this.buffer));this.setState((function(t){return{cells:e}}))}},{key:"resetBuffer",value:function(){this.buffer=JSON.parse(JSON.stringify(this.state.cells))}},{key:"getRandomTileType",value:function(){var e=this.props.level+4>=5?5:this.props.level+4,t=v(1,this.props.level+4);return t>=e?e:t}},{key:"lock",value:function(e){this.setState((function(){return{locked:!0}}),e)}},{key:"unlock",value:function(e){this.setState((function(){return{locked:!1}}),e)}}]),t}(i.a.Component)),k=(n(184),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={visible:!1},n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"menu-wrapper"},i.a.createElement("div",{className:"menu-backdrop ".concat(this.state.visible?"visible":"invisible"),onClick:this.close.bind(this)}),i.a.createElement("div",{className:"menu-icon",onClick:this.open.bind(this)}),i.a.createElement("div",{className:"menu ".concat(this.state.visible?"visible":"invisible")},i.a.createElement("div",{className:"menu-items-wrapper"},i.a.createElement("label",{htmlFor:"pause-seasons"},"Pause seasons"),i.a.createElement("input",{name:"pause-seasons",id:"pause-seasons",type:"checkbox",value:this.props.config.getString("pause-seasons","false"),onChange:function(t){e.props.setConfig("pause-seasons",t.target.checked)}}))))}},{key:"toggle",value:function(){this.setState((function(e){return{visible:!e.visible}}))}},{key:"open",value:function(){this.setState((function(e){return{visible:!0}}))}},{key:"close",value:function(){this.setState((function(e){return{visible:!1}}))}}]),t}(i.a.Component)),b=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={level:1,score:0,over:!1,won:!1,season:0,tilNextSeason:e.seasonGap,config:new h({"pause-seasons":!1})},n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.seasonTick()}),1e3)}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"app"},i.a.createElement("div",{className:"game-header"},i.a.createElement("h1",{className:"title"},"Nature's Ornaments"),i.a.createElement(k,{getConfig:function(t,n){e.getConfig(t,n)},setConfig:function(t,n){e.setConfig(t,n)},config:this.state.config})),i.a.createElement("div",{className:"game-intro"}),i.a.createElement("div",{className:"game-container season-".concat(this.getSeasonString(this.state.season).toLowerCase())},(this.state.won||this.state.over)&&i.a.createElement("div",{className:"game-message game-".concat(this.state.won?"won":this.state.over&&"over")},i.a.createElement("p",null,this.state.won?"You win!":"Board over!"),i.a.createElement("div",{className:"actions"})),i.a.createElement(y,{width:11,height:7,addScore:function(t){e.addScore(t)},level:this.state.level}),i.a.createElement("div",{className:"sidebar"},i.a.createElement("div",{className:"score-container"},this.state.score),i.a.createElement("div",{className:"level-container"},this.state.level),i.a.createElement("div",null,"Season: ",this.getSeasonString(this.state.season),i.a.createElement("div",{className:"loading-bar"},i.a.createElement("span",{style:{width:this.state.tilNextSeason/this.props.seasonGap*100}}))))),i.a.createElement("p",{className:"game-explanation"}))}},{key:"addScore",value:function(e){var t=[0,1e3,2100,3300,4600,7e3,15e3,25e3,1e11],n=(e<=4?10*e:e<=7?15*e:e<=10?20*e:25*e)+this.state.score;this.setState((function(e){var s=e.level;return t.reduce((function(e,t,i){return n>=e&&n<=t&&(s=i),t})),{score:n,level:s}}))}},{key:"getSeasonString",value:function(e){switch(e){case 0:return"Spring";case 1:return"Summer";case 2:return"Fall";case 3:return"Winter";default:return"Spring"}}},{key:"seasonTick",value:function(){var e=this;this.setState((function(t){if(!e.getConfig("pause-seasons",!0)){var n={};return n=t.tilNextSeason<=0?{season:t.season>=3?0:t.season+1,tilNextSeason:e.props.seasonGap}:{tilNextSeason:t.tilNextSeason-1e3},setTimeout(e.seasonTick.bind(e),1e3),n}}))}},{key:"getConfig",value:function(e,t){return this.state.config.get(e,t)}},{key:"setConfig",value:function(e,t){var n=this;console.log("setConfig",e,t),this.setState((function(n){return{config:n.config.set(e,t)}}),(function(){n.handleConfigUpdate(e,t)}))}},{key:"handleConfigUpdate",value:function(e,t){switch(console.log("handleConfigUpdate",e,t),e){case"pause-seasons":t||this.seasonTick()}}}]),t}(i.a.Component);n(185);o.a.render(i.a.createElement(b,{seasonGap:5e3}),document.getElementById("root"))}},[[175,1,2]]]);
//# sourceMappingURL=main.75c32364.chunk.js.map